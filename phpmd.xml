<?xml version="1.0"?>
<ruleset name="Laravel PHPMD Rules"
         xmlns="http://pmd.sf.net/ruleset/1.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://pmd.sf.net/ruleset/1.0.0 http://pmd.sf.net/ruleset_xml_schema.xsd"
         xsi:noNamespaceSchemaLocation="http://pmd.sf.net/ruleset_xml_schema.xsd">

    <description>PHPMD ruleset for Laravel project</description>

    <!-- Exclude directories -->
    <exclude-pattern>*/vendor/*</exclude-pattern>
    <exclude-pattern>*/node_modules/*</exclude-pattern>
    <exclude-pattern>*/storage/*</exclude-pattern>
    <exclude-pattern>*/bootstrap/cache/*</exclude-pattern>
    <exclude-pattern>*/database/migrations/*</exclude-pattern>
    <exclude-pattern>*/_ide_helper*.php</exclude-pattern>

    <!-- Clean Code Rules -->
    <rule ref="rulesets/cleancode.xml">
        <!-- Laravel uses static facades extensively -->
        <exclude name="StaticAccess"/>
        <!-- Laravel controllers often don't use all injected dependencies -->
        <exclude name="MissingImport"/>
    </rule>

    <!-- Code Size Rules -->
    <rule ref="rulesets/codesize.xml">
        <exclude name="TooManyPublicMethods"/>
    </rule>
    <rule ref="rulesets/codesize.xml/TooManyPublicMethods">
        <properties>
            <!-- Increase threshold for Laravel controllers and services -->
            <property name="maxmethods" value="15"/>
        </properties>
    </rule>
    <rule ref="rulesets/codesize.xml/ExcessiveMethodLength">
        <properties>
            <property name="minimum" value="100"/>
        </properties>
    </rule>
    <rule ref="rulesets/codesize.xml/ExcessiveClassLength">
        <properties>
            <property name="minimum" value="500"/>
        </properties>
    </rule>
    <rule ref="rulesets/codesize.xml/CyclomaticComplexity">
        <properties>
            <property name="reportLevel" value="15"/>
        </properties>
    </rule>
    <rule ref="rulesets/codesize.xml/NPathComplexity">
        <properties>
            <property name="minimum" value="300"/>
        </properties>
    </rule>

    <!-- Controversial Rules -->
    <rule ref="rulesets/controversial.xml">
        <!-- Laravel uses camelCase for methods which is standard -->
        <exclude name="CamelCaseMethodName"/>
        <!-- Laravel models use snake_case properties -->
        <exclude name="CamelCasePropertyName"/>
        <!-- Laravel uses snake_case for variables in some contexts -->
        <exclude name="CamelCaseVariableName"/>
    </rule>

    <!-- Design Rules -->
    <rule ref="rulesets/design.xml">
        <!-- Laravel controllers may have multiple exit points -->
        <exclude name="ExitExpression"/>
        <!-- Laravel uses eval in some internal components -->
        <exclude name="EvalExpression"/>
    </rule>
    <rule ref="rulesets/design.xml/CouplingBetweenObjects">
        <properties>
            <!-- Increase threshold for Laravel services -->
            <property name="maximum" value="20"/>
        </properties>
    </rule>

    <!-- Naming Rules -->
    <rule ref="rulesets/naming.xml">
        <!-- Short variable names like $id, $e are common in Laravel -->
        <exclude name="ShortVariable"/>
        <!-- Long variable names are sometimes necessary for clarity -->
        <exclude name="LongVariable"/>
    </rule>
    <rule ref="rulesets/naming.xml/ShortVariable">
        <properties>
            <!-- Allow common short names -->
            <property name="exceptions" value="id,e,i,j,k,q,db"/>
        </properties>
    </rule>
    <rule ref="rulesets/naming.xml/LongVariable">
        <properties>
            <property name="maximum" value="30"/>
        </properties>
    </rule>

    <!-- Unused Code Rules -->
    <rule ref="rulesets/unusedcode.xml">
        <!-- Laravel injects dependencies that may not always be used -->
        <exclude name="UnusedFormalParameter"/>
    </rule>

</ruleset>